{"version":3,"file":"ocanvas.js","sources":["../src/components/Layer.js","../node_modules/style-inject/dist/style-inject.es.js","../util/useJsCanvas.js","../util/useWindowDimensions.js","../src/Canvas/Canvas.js"],"sourcesContent":["import React, { useContext, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport '../Canvas/Canvas.scss';\nimport { JsCanvasContext } from '../../util/useJsCanvas';\n\nconst Layer = ({\n\tchildren,\n\tname,\n\tid,\n\tratio,\n\twidth,\n\theight,\n\tkeyframes,\n\tstyle,\n\tlayerStyle,\n\tplaySpeed,\n\tdelay,\n\tautoPlay,\n\titeration,\n}) => {\n\tconst jsCanvas = useContext(JsCanvasContext);\n\n\tuseEffect(() => {\n\t\tconst newItem = jsCanvas.newItem(`.Layer-${name}`, { selector: true });\n\t\tnewItem.set({\n\t\t\t...keyframes,\n\t\t\toptions: {\n\t\t\t\tdelay: delay,\n\t\t\t\titeration: iteration,\n\t\t\t},\n\t\t});\n\t}, []);\n\n\treturn (\n\t\t<div\n\t\t\tdata-testid={`Layer-${name}`}\n\t\t\tstyle={{\n\t\t\t\tposition: 'absolute',\n\t\t\t\tleft: 0,\n\t\t\t\tright: 0,\n\t\t\t\ttop: 0,\n\t\t\t\tbottom: 0,\n\t\t\t\tmargin: 'auto',\n\t\t\t\t...layerStyle,\n\t\t\t}}\n\t\t>\n\t\t\t<div\n\t\t\t\tstyle={{\n\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\twidth: width,\n\t\t\t\t\theight: height,\n\t\t\t\t\tleft: 0,\n\t\t\t\t\tright: 0,\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tbottom: 0,\n\t\t\t\t\tmargin: 'auto',\n\t\t\t\t\t...style,\n\t\t\t\t}}\n\t\t\t\tclassName={`Layer-${name}`}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nLayer.defaultProps = {\n\tname: 'animation',\n\tid: 1,\n\tratio: {\n\t\twidth: 1080,\n\t\theight: 720,\n\t},\n\twidth: 300,\n\theight: 300,\n\tkeyframes: {},\n\tstyle: {},\n\tlayerStyle: {},\n\tplaySpeed: 1,\n\tdelay: 0,\n\tautoPlay: false,\n\tchildren: () => <></>,\n\titeration: 'infinite',\n};\n\nLayer.propTypes = {\n\tname: PropTypes.string,\n\tid: PropTypes.number,\n\tratio: PropTypes.object,\n\twidth: PropTypes.any,\n\theight: PropTypes.any,\n\tkeyframes: PropTypes.object,\n\tstyle: PropTypes.object,\n\tlayerStyle: PropTypes.object,\n\tplaySpeed: PropTypes.number,\n\tdelay: PropTypes.number,\n\tautoPlay: PropTypes.bool,\n\tchildren: PropTypes.any,\n\titeration: PropTypes.any,\n};\n\nexport { Layer };\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import { createContext, useEffect, useState } from 'react';\nimport Scene from 'scenejs';\n\nconst JsCanvasContext = createContext(null);\n\nexport { JsCanvasContext };\n","import { useEffect, useState } from 'react';\n\nfunction getWindowDimensions() {\n\tconst { innerWidth: width, innerHeight: height } =\n\t\ttypeof window !== 'undefined' ? window : {};\n\treturn {\n\t\twidth,\n\t\theight,\n\t};\n}\n\nexport default function useWindowDimensions(\n\tcanvasContentRef,\n\tmaxWidth,\n\tmaxHeight\n) {\n\tconst [windowDimensions, setWindowDimensions] = useState(\n\t\tgetWindowDimensions()\n\t);\n\n\tuseEffect(() => {\n\t\tfunction handleResize() {\n\t\t\tlet theRatio = {\n\t\t\t\theight: getWindowDimensions().height / (16 / 9),\n\t\t\t\twidth: getWindowDimensions().width / (16 / 9),\n\t\t\t};\n\n\t\t\ttheRatio.scale = Math.min(\n\t\t\t\ttheRatio.width / maxWidth,\n\t\t\t\ttheRatio.height / maxHeight\n\t\t\t);\n\t\t\tsetWindowDimensions(theRatio);\n\t\t}\n\n\t\thandleResize();\n\n\t\twindow.addEventListener('resize', handleResize);\n\t\treturn () => window.removeEventListener('resize', handleResize);\n\t}, []);\n\n\treturn windowDimensions;\n}\n","import React, { useContext, useEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport './Canvas.scss';\nimport useWindowDimensions from '../../util/useWindowDimensions';\nimport Scene from 'scenejs';\nimport { JsCanvasContext } from '../../util/useJsCanvas';\n\nconst CanvasContainer = ({ children, width, height }) => {\n\tconst jsCanvas = useContext(JsCanvasContext);\n\tconst canvasRef = useRef(null);\n\tconst [isPlaying, setIsPlaying] = useState(false);\n\tconst [progress, setProgress] = useState(0);\n\tconst {\n\t\theight: windowHeight,\n\t\twidth: windowWidth,\n\t\tscale,\n\t} = useWindowDimensions(canvasRef, width, height);\n\n\tuseEffect(() => {\n\t\tlet duration = jsCanvas.getDuration();\n\t\tconsole.log('duration:', duration);\n\t\tconsole.log('children:', children[0].props);\n\t\tjsCanvas.on('play', (e) => {\n\t\t\tsetIsPlaying(true);\n\t\t});\n\t\tjsCanvas.on('paused', (e) => {\n\t\t\tsetIsPlaying(false);\n\t\t});\n\t\tjsCanvas.on('animate', (e) => {\n\t\t\tsetProgress((100 * e.time) / duration);\n\t\t});\n\t}, []);\n\n\treturn (\n\t\t<div id=\"canvasContainer\">\n\t\t\t<div className=\"Canvas\" id=\"recorderCanvas\" ref={canvasRef}>\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"CanvasInner\"\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\twidth: windowWidth,\n\t\t\t\t\t\theight: windowHeight,\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tid=\"Composition\"\n\t\t\t\t\t\tclassName=\"Composition\"\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\t\theight: height,\n\t\t\t\t\t\t\ttransform: `translate(-50%, -50%) scale(${scale})`,\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"Layers\"\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\t\t\theight: height,\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{children}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"playerWrapper\">\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"player\"\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\twidth: windowWidth,\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={`${isPlaying ? 'pause' : 'play'}`}\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tjsCanvas.isPaused() ? jsCanvas.play() : jsCanvas.pause();\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t\t<input\n\t\t\t\t\t\tclassName=\"progress\"\n\t\t\t\t\t\ttype=\"range\"\n\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\tjsCanvas.pause();\n\t\t\t\t\t\t\tjsCanvas.setTime(e.target.value + '%');\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tvalue={progress}\n\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\tmax=\"100\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nconst Canvas = ({ children, width, height }) => {\n\treturn (\n\t\t<JsCanvasContext.Provider\n\t\t\tvalue={new Scene(\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\teasing: Scene.EASE_IN_OUT,\n\t\t\t\t\titerationCount: 1,\n\t\t\t\t\tselector: true,\n\t\t\t\t}\n\t\t\t).setTime(0)}\n\t\t>\n\t\t\t<CanvasContainer height={height} width={width}>\n\t\t\t\t{children}\n\t\t\t</CanvasContainer>\n\t\t</JsCanvasContext.Provider>\n\t);\n};\n\nCanvas.propTypes = {\n\twidth: PropTypes.number,\n\theight: PropTypes.number,\n\tchildren: PropTypes.any,\n};\n\nexport { Canvas };\n"],"names":["Layer","_ref","children","name","width","id","ratio","height","keyframes","style","layerStyle","delay","playSpeed","iteration","autoPlay","jsCanvas","useContext","JsCanvasContext","useEffect","newItem","concat","selector","set","_objectSpread","options","React","createElement","data-testid","position","left","right","top","bottom","margin","className","css","insertAt","ref","document","head","getElementsByTagName","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","createContext","getWindowDimensions","window","innerWidth","innerHeight","defaultProps","Fragment","propTypes","PropTypes","string","number","object","any","bool","CanvasContainer","maxWidth","maxHeight","setWindowDimensions","canvasRef","useRef","isPlaying","_useState2","_slicedToArray","useState","setIsPlaying","progress","_useState4","setProgress","windowDimensions","handleResize","theRatio","scale","Math","min","addEventListener","removeEventListener","windowHeight","windowWidth","duration","getDuration","console","log","props","on","e","time","transform","onClick","isPaused","play","pause","onChange","setTime","target","value","max","Canvas","_ref2","Provider","Scene","easing","EASE_IN_OUT","iterationCount"],"mappings":"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"}