!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types"),require("scenejs"),require("@daybrush/utils")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","scenejs","@daybrush/utils"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ocanvas={},e.React,e.PropTypes,e.Scene,e.utils)}(this,function(e,x,t,u,n){"use strict";function a(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function p(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach(function(e){var t,n;t=r,n=i[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1})}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=s(n),t=(e=r?(e=s(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(e=t))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){l=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw i}}return a}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?f(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e){var t=e.children,n=e.name,r=e.id,i=e.ratio,a=e.keyframes,o=e.style,l=(e.layerStyle,e.playSpeed),s=e.delay,u=(e.autoPlay,e.iteration),c=x.useContext(k),d=n.replaceAll(" ","_")+r;return x.useEffect(function(){c.newItem(".Layer-".concat(d),{selector:!0,delay:s,playSpeed:l}).set(p(p({},a),{},{options:{delay:s,iteration:u,playSpeed:l}}))},[n,a,u]),x.createElement("div",{"data-testid":"Layer-".concat(d),className:"Layer-".concat(d),style:p({position:"absolute",width:i.width,height:i.height,left:0,right:0,top:0,bottom:0,margin:"auto"},o)},t)}h=':root {\n  --background: #fff;\n  --font-color: #494949; }\n\n@media (prefers-color-scheme: dark) {\n  :root {\n    --background: #494949;\n    --font-color: #fafafa; } }\n\n#canvasContainer {\n  min-width: 100%;\n  min-height: 100%; }\n\n.Canvas {\n  font-family: "Avenir Next", Helvetica, Arial, sans-serif;\n  font-size: 14px;\n  margin: auto;\n  flex-shrink: 0;\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  height: 100%;\n  width: 100%;\n  background: #ebecf0; }\n  .Canvas .CanvasInner {\n    grid-area: canvas;\n    position: relative;\n    z-index: 0;\n    padding: 10px; }\n    .Canvas .CanvasInner .Composition {\n      position: relative;\n      left: 50%;\n      top: 50%;\n      transform: translate(-50%, -50%);\n      transform-origin: center center;\n      -webkit-box-shadow: 0 2px 8px rgba(14, 19, 24, 0.07);\n      -moz-box-shadow: 0 2px 8px rgba(14, 19, 24, 0.07);\n      box-shadow: 0 2px 8px rgba(14, 19, 24, 0.07);\n      overflow: hidden; }\n      .Canvas .CanvasInner .Composition .Layers {\n        pointer-events: none;\n        background: white; }\n\n.playerWrapper {\n  position: absolute;\n  bottom: 20px;\n  margin: 0;\n  left: 0;\n  right: 0;\n  z-index: 99999999999;\n  display: flex;\n  justify-content: center; }\n\n.player {\n  position: relative;\n  align-items: center;\n  display: flex; }\n\n.circles .circle {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 200px;\n  height: 200px;\n  border: 100px solid black;\n  border-radius: 50%;\n  transform: translate(-50%, -50%); }\n\n.player .play, .player .pause, .player .progress {\n  display: inline-block;\n  vertical-align: middle; }\n\n.player .play {\n  border-left: 14px solid #333;\n  border-top: 8px solid transparent;\n  border-bottom: 8px solid transparent; }\n\n.player .pause {\n  border-left: 4px solid #333;\n  border-right: 4px solid #333;\n  width: 14px;\n  height: 16px;\n  box-sizing: border-box; }\n\n.player input[type=range] {\n  flex: auto; }\n\n.player input[type=range] {\n  -webkit-appearance: none;\n  background: rgba(0, 0, 0, 0.2);\n  height: 3px;\n  margin-left: 10px; }\n\n.player input[type=range]::-webkit-slider-thumb {\n  -webkit-appearance: none;\n  width: 14px;\n  height: 14px;\n  border-radius: 7px;\n  background: #333; }\n\n.player input[type=range]:focus {\n  outline: none; }\n\n.raindrop {\n  position: absolute;\n  width: 300px;\n  height: 300px;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  margin: auto;\n  border: 100px solid black;\n  border-radius: 50%;\n  box-sizing: border-box;\n  transform: scale(0); }\n',m=(m=void 0===m?{}:m).insertAt,"undefined"!=typeof document&&(g=document.head||document.getElementsByTagName("head")[0],(b=document.createElement("style")).type="text/css","top"===m&&g.firstChild?g.insertBefore(b,g.firstChild):g.appendChild(b),b.styleSheet?b.styleSheet.cssText=h:b.appendChild(document.createTextNode(h)));var h,m,g,b,k=x.createContext(null),v=x.createContext(null);function j(){var e="undefined"!=typeof window?window:{};return{width:e.innerWidth,height:e.innerHeight}}y.defaultProps={name:"animation",id:1,ratio:{width:1080,height:720},keyframes:{},style:{},layerStyle:{},playSpeed:1,delay:0,autoPlay:!1,children:x.createElement("div",null),iteration:"infinite"},y.propTypes={name:t.string,id:t.number,ratio:t.object,keyframes:t.object,style:t.object,layerStyle:t.object,playSpeed:t.number,delay:t.number||t.string,autoPlay:t.bool,children:t.any,iteration:t.any};function w(e){var t,n,r,i=e.children,a=e.width,o=e.height,l=e.jsCanva,s=e.autoPlay,u=e.controls,c=e.playing,d=e.fullWidth,p=e.animationDuration,f=x.useContext(k),e=x.useRef(null),y=(w=P(x.useState(!1),2))[0],h=w[1],m=(w=P(x.useState(0),2))[0],g=w[1];t=a,n=o,w=P(x.useState(j()),2),b=w[0],r=w[1],x.useEffect(function(){function e(){var e={height:j().height/(16/9),width:j().width/(16/9)};e.scale=Math.min(e.width/t,e.height/n),r(e)}return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}},[]);var b=(w=b).height,v=w.width,w=w.scale;return x.useEffect(function(){var t=f.getDuration();l(f),p(t),s&&(f.play(),h(!0)),f.on("play",function(e){h(!0)}),f.on("paused",function(e){h(!1)}),f.on("animate",function(e){g(100*e.time/t)}),c({playing:y,progress:m})},[y,m]),x.createElement("div",{id:"canvasContainer"},x.createElement("div",{className:"Canvas",id:"recorderCanvas",ref:e},x.createElement("div",{className:"CanvasInner",style:d?{width:"100%",height:"100%"}:{width:v,height:b}},x.createElement("div",{id:"Composition",className:"Composition",style:d?{width:a,height:o}:{width:a,height:o,transform:"translate(-50%, -50%) scale(".concat(w||1,")")}},x.createElement("div",{className:"Layers",style:{width:a,height:o}},i)))),u&&x.createElement("div",{className:"playerWrapper"},x.createElement("div",{className:"player",style:{width:v}},x.createElement("div",{className:"".concat(y?"pause":"play"),onClick:function(){f.isPaused()?f.play():f.pause()}}),x.createElement("input",{className:"progress",type:"range",onChange:function(e){f.pause(),f.setTime(e.target.value+"%")},value:m.toString(),min:"0",max:"100"}))))}function E(e){var t=e.children,n=e.width,r=e.height,i=e.jsCanva,a=e.autoPlay,o=e.controls,l=e.playing,s=e.fullWidth,e=e.animationDuration;return x.createElement(k.Provider,{value:new u({},{easing:u.EASE_IN_OUT,iterationCount:1,selector:!0}).setTime(0)},x.createElement(v.Provider,{value:new I},x.createElement(w,{height:r,width:n,autoPlay:a,controls:o,playing:l,jsCanva:i,fullWidth:s,animationDuration:e},t)))}l(T,u),C=d(T),o(T,[{key:"getMediaItem",value:function(){return this.mediaItem}},{key:"getVolume",value:function(){return this.mediaItem.get(0,"volume")}},{key:"setVolume",value:function(e){return this.mediaItem.set(0,"volume",e),this}},{key:"setPlaySpeed",value:function(e){return this.mediaItem.setPlaySpeed(e),this}},{key:"seek",value:function(e,t){var n=this.mediaItem;return n.set(0,"seek",e),n.set("100%","seek",t),n.setDuration(t-e),this}},{key:"setElement",value:function(e){return this.mediaItem.setElement(e),this}},{key:"getMediaElement",value:function(){return this.mediaItem.getElements()[0]}},{key:"getInfo",value:function(){var e=this.mediaItem,t=[e.get(0,"seek"),e.get("100%","seek")],e=e.getPlaySpeed(),n=this.getVolume(),r=this.getDelay();return{url:this.url,seek:t,playSpeed:e,delay:r,volume:n}}},{key:"init",value:function(e){var t,c=this,d=this.newItem("media"),p=(console.log("mediaItem:",d),d.newFrame(0),d.newFrame(1),d.set(0,"volume",1),d.set(0,"seek",0),d.set("100%","seek",0),console.log("mediaItemafter:",d),this.mediaItem=d,n.isString(e)?((t=new Audio).src=e,this.setElement(t),this.url=e):(e.src?this.url=e.src:(t=e.querySelector("[src]"),this.url=t?t.src:""),this.setElement(e)),0);this.on("paused",function(e){var t;c.isPlayMedia=!1,null!=(t=c.getMediaElement())&&t.pause()}),this.on("animate",function(e){var t=c.getMediaElement(),n=(t.muted=!1,e.time),r=n<p,i="running"===c.getPlayState(),a=-1<c.getDirection().indexOf("reverse"),o=c.isPlayMedia,e=e.frames.media,l=d.getPlaySpeed(),s=c.getDuration(),u=c.getVolume(),e=e.get("seek");p=n,i&&o||(t.playbackRate=l*(a?-1:1),t.currentTime=e),r||n<=0||s<=n?i&&(c.isPlayMedia=!1,t.pause()):(t.volume=u,!o&&i&&(c.isPlayMedia=!0,(l=t.play())instanceof Promise)&&l.catch(function(){t.muted=!0,t.play()}))})}}]);var O,C,S=T,I=(l(D,u),O=d(D),o(D,[{key:"addMedia",value:function(e){var t=new S(1<arguments.length&&void 0!==arguments[1]?arguments[1]:e);return this.setItem(e,t),t}},{key:"getInfo",value:function(){var t={duration:0,medias:[]};return this.forEach(function(e){t.medias.push(e.getInfo())}),t.duration=this.getDuration(),t}}]),D);function D(){var e;return r(this,D),(e=O.call(this)).playInfos={},e}function T(e){var t;return r(this,T),(t=C.call(this)).isPlayMedia=!0,t.init(e),t}E.defaultProps={width:1920,height:1080,children:[],autoPlay:!1,controls:!0,playing:function(){},jsCanva:function(){},fullWidth:!1,animationDuration:function(){}},E.propTypes={width:t.number,height:t.number,children:t.any,autoPlay:t.bool,controls:t.bool,playing:t.func,jsCanva:t.any,fullWidth:t.bool,animationDuration:t.func},e.Canvas=E,e.Layer=y});
//# sourceMappingURL=ocanvas.js.map
